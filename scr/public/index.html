<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aplikasi Manajemen Perhitungan Diskon</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Aplikasi Manajemen Perhitungan Diskon</h1>

  <form id="form-diskon">
    <h2>Tambah Barang</h2>
    <div>
      <label for="nama_barang">Nama Barang:</label>
      <input type="text" id="nama_barang" required>
    </div>
    <div>
      <label for="kategori">Kategori:</label>
      <input type="text" id="kategori" required>
    </div>
    <div>
      <label for="harga_awal">Harga Awal:</label>
      <input type="number" id="harga_awal" step="0.01" required>
    </div>
    <div>
      <label for="diskon_persen">Diskon (%):</label>
      <input type="number" id="diskon_persen" step="0.01" required>
    </div>
    <div>
      <label for="stok">Stok:</label>
      <input type="number" id="stok" required>
    </div>
    <button type="submit">Tambah Barang</button>
  </form>

  <h2>Hasil Perhitungan Diskon</h2>
  <table id="tabel-diskon">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nama Barang</th>
        <th>Kategori</th>
        <th>Harga Awal</th>
        <th>Diskon (%)</th>
        <th>Harga Setelah Diskon</th>
        <th>Stok</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

  <script>
    let idCounter = 1;

    document.getElementById('form-diskon').addEventListener('submit', function(event) {
      event.preventDefault();

      // Mengambil nilai dari input form
      const nama_barang = document.getElementById('nama_barang').value;
      const kategori = document.getElementById('kategori').value;
      const harga_awal = parseFloat(document.getElementById('harga_awal').value);
      const diskon_persen = parseFloat(document.getElementById('diskon_persen').value);
      const stok = parseInt(document.getElementById('stok').value);
      
      // Menghitung harga setelah diskon
      const harga_setelah_diskon = harga_awal - (harga_awal * (diskon_persen / 100));
      const id = idCounter++;

      // Menambahkan data ke tabel di halaman
      const tabelDiskon = document.getElementById('tabel-diskon').getElementsByTagName('tbody')[0];

      let row = tabelDiskon.insertRow();
      row.id = `diskon-${id}`;
      row.innerHTML = `<td>${id}</td><td>${nama_barang}</td><td>${kategori}</td><td>${harga_awal.toFixed(2)}</td><td>${diskon_persen}%</td>
                        <td>${harga_setelah_diskon.toFixed(2)}</td><td>${stok}</td>
                        <td><button onclick="hapusData(${id})">Hapus</button></td>`;
      const data = {
        nama_barang: nama_barang,
        kategori: kategori,
        harga_awal: harga_awal,
        diskon_persen: diskon_persen,
        harga_setelah_diskon: harga_setelah_diskon,
        stok: stok
      };

      fetch('http://localhost:1900/api/diskon', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(data => {
        console.log('Data berhasil dikirim:', data);
      })
      .catch((error) => {
        console.error('Error:', error);
      });
      document.getElementById('form-diskon').reset();
    });
    function hapusData(id) {
      if (confirm('Apakah Anda yakin ingin menghapus data ini?')) {
        let row = document.getElementById(`diskon-${id}`);
        if (row) {
          row.remove();
          
          // Mengirim request DELETE ke API
          fetch(`http://localhost:1900/api/diskon/${id}`, {
            method: 'DELETE'
          })
          .then(response => response.json())
          .then(data => {
            console.log('Data berhasil dihapus:', data);
          })
          .catch((error) => {
            console.error('Error:', error);
          });
        }
      }
    }
  </script>

  <script src="app.js"></script>
  <script src="api.js"></script>
  <script src="listener.js"></script>
</body>
</html>
